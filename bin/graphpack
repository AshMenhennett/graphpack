#!/usr/bin/env node

const nodemon = require('nodemon');
const path = require('path');
const { once } = require('ramda');
const webpack = require('webpack');
const paths = require('../config/paths');
const webpackConfig = require('../config/webpack.config');

const compiler = webpack(webpackConfig);
const serverPaths = Object.keys(compiler.options.entry).map(entry =>
  path.join(compiler.options.output.path, `${entry}.js`),
);

compiler.watch(
  webpackConfig.watchOptions,
  once(error => {
    if (error) return;

    nodemon({ script: serverPaths[0], watch: serverPaths }).on(
      'quit',
      process.exit,
    );
  }),
);
